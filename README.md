# אלגוריתם פאקמן – Ex3Algo

מסמך זה מתאר את האלגוריתם של פאקמן. בכל צעד פאקמן בוחן את מצב הלוח, מזהה מהו המהלך החשוב ביותר באותו רגע, ובוחר את כיוון התנועה בהתאם.

האלגוריתם מבוסס על חישובי מרחקים בעזרת BFS (`allDistance`) ועל מציאת מסלולים קצרים (`shortestPath`), כפי שמומשו במטלה הקודמת (Ex2).

---

## הרעיון הכללי

בכל צעד פאקמן יכול לנוע לאחד מארבעה כיוונים: למעלה, למטה, ימינה או שמאלה.  
ההחלטה לאיזה כיוון לזוז מתקבלת לפי ארבעה מצבים, המוגדרים על פי צבעים בלוח:

- **ורוד** – נקודות רגילות שצריך לאכול (המטרה הראשית)
- **שחור** – מפלצת מסוכנת שצריך לברוח ממנה
- **לבן** – מפלצת שאפשר לאכול
- **ירוק** – נקודת כוח שהופכת את המפלצות לאכילות לזמן מוגבל

האלגוריתם פועל לפי סדר עדיפויות ברור, כאשר הישרדות קודמת לכל.
>הערה: מצבי ירוק ולבן מבוצעים רק במקרים כאשר הם עדיפים על הורוד.

---

## חישובים שמבוצעים בכל צעד

בכל צעד האלגוריתם מבצע את הפעולות הבאות:

1. קורא את מיקום פאקמן ואת מצב הלוח הנוכחי.
2. מחשב מפת מרחקים באמצעות:
allDistance(pacmanPosition, BLUE)
במפת המרחקים כל תא מכיל את מספר הצעדים המינימלי הנדרש כדי להגיע אליו ממיקום פאקמן, מבלי לעבור דרך קירות (BLUE).  
תאים שלא ניתן להגיע אליהם מקבלים ערך ‎-1.

---

## מצב 1 – שחור (בריחה ממפלצת)

### מתי נכנסים למצב זה?
- קיימת מפלצת שחורה (שאינה אכילה).
- המרחק שלה מפאקמן קטן מ־8 משבצות.

### מה פאקמן עושה?
- בוחר כיוון תנועה שמגדיל את המרחק בינו לבין המפלצת השחורה הקרובה ביותר.

זהו המצב בעל העדיפות הגבוהה ביותר, והוא מבטל כל מצב אחר.

---

## מצב 2 – ורוד (אכילת נקודות רגילות)

### מתי נכנסים למצב זה?
- אין סכנה מיידית ממפלצות שחורות.

### מה פאקמן עושה?
- מאתר את הנקודה הוורודה הקרובה ביותר.
- מחשב מסלול קצר אליה.
- מתקדם צעד אחד לאורך המסלול.

### המטרה:
לאכול את כל הנקודות הוורודות ולסיים את המשחק.

---

## מצב 3 – ירוק (נקודת כוח)

### מתי נכנסים למצב זה?
- קיימת נקודה ירוקה על המפה
- בדרך לנקודה ורודה
- .
- רק אם הירוק לא פעיל - אכלתי כבר ירוק והמפלצות כבר לבנות
- וגם אם הירוק קרוב מספיק - פחות מ־4 צעדים.

### מה פאקמן עושה?
- מתקדם לעבר הנקודה הירוקה הקרובה ביותר לפי מפת המרחקים.
- זז צעד אחד לכיוון הנקודה.

### המטרה:
להפוך מפלצות מסוכנות למפלצות אכילות ולאפשר תנועה בטוחה יותר על הלוח
הירוק משמש בעיקר להגנה ולתנועה בטוחה.

---

## מצב 4 – לבן (אכילת מפלצת)

### מתי נכנסים למצב זה?
- פאקמן אכל נקודה ירוקה, וכל המפלצות לבנות.
- קיימת מפלצת לבנה שניתן לאכול.
- הזמן שנותר למפלצת להיות אכילה מספיק כדי שפאקמן יוכל להגיע אליה
- הפאקמן ינסה לאכול לבן רק אם הוא מספיק קרוב (לפי מפת המרחקים והזמן שנותר למפלצת להיות אכילה).

### מה פאקמן עושה?
- מחשב מסלול קצר ביותר אל המפלצת הלבנה.
- מתקדם צעד אחד לאורך המסלול.

### המטרה:
להוריד מפלצות מהלוח לזמן קצר.  
אכילת מפלצות לבנות אינה מטרה בפני עצמה, אלא פעולה משנית בלבד.

---

## סדר עדיפויות בין המצבים

1. שחור – בריחה ממפלצת (חובה תמיד)  
2. לבן – אכילת מפלצת (רק אם אפשר להספיק לאכול אותה לפני שתפסיק להיות אכילה)
3. ירוק – נקודת כוח (רק אם כדאי יותר מוורוד, לדוגמה קרוב יותר או מסוכן יותר)  
4. ורוד – אכילת נקודות רגילות (המטרה הראשית, ברירת מחדל)  

------

## Pseudo-code – קבלת החלטת תנועה

```text
Input: pacmanPos, ghosts[], map

1. Compute distance map from pacman:
   dists = allDistance(pacmanPos, BLUE)

2. Mode 1 – Escape from black ghosts (highest priority)
   closestBlack = find closest non-eatable ghost within 8 steps
   if closestBlack exists:
       dir = move in the direction that increases distance from closestBlack
       return dir

3. Mode 2 – Eat white ghosts (if any)
   closestWhite = find closest eatable ghost (white)
   if closestWhite exists and distance <= remaining eatable time and distance <= 4:
       path = shortestPath(pacmanPos, closestWhite, BLUE)
       return next step along path

4. Mode 3 – Move to green power dot (if useful)
   closestGreen = find closest green dot
   if closestGreen exists and distance <= 4 steps and greenPower not active:
       path = shortestPath(pacmanPos, closestGreen, BLUE)
       return next step along path

5. Mode 4 – Eat pink points (default)
   closestPink = find closest pink dot
   if closestPink exists:
       path = shortestPath(pacmanPos, closestPink, BLUE)
       return next step along path

6. If no move is possible:
   return random legal direction
```


## מקרי קצה

- אובייקט שלא ניתן להגיע אליו (מרחק ‎-1) – מתעלמים ממנו.
- כאשר קיימות מספר מפלצות שחורות – מתייחסים רק לקרובה ביותר.
- אם אין כיוון שמגדיל מרחק במצב שחור – נבחר כיוון חוקי כלשהו.
- אם `shortestPath` מחזיר `null` – עוברים למצב הבא לפי סדר העדיפויות.
- אם אין נקודות ורודות על המפה – מנסים להגיע לנקודה ירוקה או מבצעים תנועה חוקית.

---
